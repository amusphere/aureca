# 実装計画

- [ ] 1. データベーススキーマとマイグレーションの実装
  - AIChatUsageLogテーブルをschema.pyに追加し、適切なリレーションシップとインデックスを設定
  - Alembicマイグレーションファイルを生成して、データベーススキーマを更新
  - _要件: 2.1, 2.2, 2.3_

- [ ] 2. バックエンドリポジトリ層の実装
  - AIChatUsageRepositoryクラスを作成し、利用回数の取得・更新・作成機能を実装
  - 日次利用回数の効率的なクエリメソッドを実装
  - データベーストランザクションの適切な処理を実装
  - _要件: 2.1, 2.2_

- [ ] 3. バックエンドサービス層の実装
  - AIChatUsageServiceクラスを作成し、ビジネスロジックを実装
  - プラン別利用制限の設定管理機能を実装
  - 利用回数チェックと増分処理のメソッドを実装
  - _要件: 1.1, 1.2, 3.1, 3.2, 3.3_

- [ ] 4. バックエンドPydanticモデルの実装
  - AIChatUsageResponseとAIChatUsageErrorモデルを作成
  - リクエスト・レスポンスの型安全性を確保
  - _要件: 4.1, 5.1_

- [ ] 5. バックエンドAPIエンドポイントの実装
  - 利用回数チェック用のGETエンドポイントを実装
  - 利用回数記録用の内部APIを実装
  - 適切なHTTPステータスコードとエラーレスポンスを実装
  - _要件: 3.1, 3.2, 5.1, 5.2_

- [ ] 6. 既存AIプロセスAPIの利用制限統合
  - /api/ai/processエンドポイントに利用回数チェック機能を統合
  - 制限超過時の適切なエラーレスポンスを実装
  - 利用回数の自動インクリメント処理を追加
  - _要件: 3.1, 3.2, 3.3, 5.1, 5.2_

- [ ] 7. フロントエンドTypeScript型定義の実装
  - AIChatUsageとAIChatUsageError型を定義
  - API レスポンスの型安全性を確保
  - _要件: 4.1, 5.1_

- [ ] 8. フロントエンドカスタムフックの実装
  - useAIChatUsageフックを作成し、利用状況の状態管理を実装
  - API通信とエラーハンドリングを実装
  - リアルタイム更新機能を実装
  - _要件: 4.1, 4.2, 5.1, 5.2_

- [ ] 9. AIChatModalコンポーネントの利用制限UI統合
  - 残り利用回数の表示機能を追加
  - 利用制限時のフォーム無効化を実装
  - エラーメッセージの表示機能を追加
  - レスポンシブデザインを維持
  - _要件: 4.1, 4.2, 4.3, 5.1, 5.2, 5.3_

- [ ] 10. ChatInputコンポーネントの制限対応
  - 利用制限時の入力フィールド無効化を実装
  - 制限状態に応じたプレースホルダーテキストの変更
  - 送信ボタンの状態制御を実装
  - _要件: 4.2, 4.3_

- [ ] 11. エラーハンドリングとユーザーメッセージの実装
  - 日本語エラーメッセージの定数定義を作成
  - エラー種別に応じた適切なメッセージ表示を実装
  - リセット時刻の表示機能を実装
  - _要件: 5.1, 5.2, 5.3_

- [ ] 12. バックエンド単体テストの実装
  - AIChatUsageRepositoryのテストケースを作成
  - AIChatUsageServiceのビジネスロジックテストを作成
  - 境界値テストと異常系テストを実装
  - _要件: 1.1, 1.2, 2.1, 3.1, 3.2_

- [ ] 13. フロントエンド単体テストの実装
  - useAIChatUsageフックのテストケースを作成
  - AIChatModalコンポーネントのテストを作成
  - エラー状態とUI制御のテストを実装
  - _要件: 4.1, 4.2, 5.1, 5.2_

- [ ] 14. 統合テストの実装
  - API エンドポイントの統合テストを作成
  - フロントエンド・バックエンド間の通信テストを実装
  - エラーハンドリングの統合テストを作成
  - _要件: 3.1, 3.2, 5.1, 5.2_

- [ ] 15. 設定管理とプラン制限の実装
  - プラン別利用制限の設定ファイルまたは環境変数を実装
  - 設定変更の動的反映機能を実装
  - 将来の拡張性を考慮した設計を確保
  - _要件: 1.1, 1.2, 1.3, 6.1, 6.2, 6.3_